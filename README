
XCAP Client
===========


Prerequisites
-------------

See the Prerequisites section of the INSTALL document for OpenXCAP server
from http://openxcap.org


Installation
------------

1. Copy xcapclient.ini.sample to ~/xcapclient.ini and change accordingly to
   your XCAP servers configuration. You may set the username, domain,
   password and xcap root, which can be overwritten by the coresponding
   parameters of the command line

2. For argument and node-selector bash completion:
   sudo cp bash_completion.d/xcapclient /etc/bash_completion.d/

3. Run 'python setup.py install' to install the software in the system 

   Alternatively you can run xcapclient from its local directory.


Usage
-----

The XCAP client allows you to manage documents on an XCAP server. The
software has been tested against OpenXCAP server http://openxcap.org

To test this script you can register a SIP SIMPLE account on
http://sip2sip.info, which provides a fully functional OpenXCAP server.


1. Operating on XCAP documents (full document handling)

  a. PUT

  xcapclient --app pres-rules -i pres-rules.xml put

  to put a a presence rules document or 

  xcapclient --app resource-lists -i resource-lists.xml put

  to put a resource-lists document on the server.
 
  On success, the command prints '201 Created' if a new document was created on the
  server or '200 OK' if an existing document was replaced. You should something like this:

  url: http://xcap.example.com/xcap-root/resource-lists/users/alice@example.com/index.xml
  201 Created
  etag: "856bdac9012ee28e46cebb81e51ac2a0"

  b. GET

  xcapclient --app resource-lists get

  or

  xcapclient --app pres-rules get

  This will print the document you've just put, along with its tag.

  c. DELETE

  xcapclient --app resource-lists delete


2. Operating on XML elements (partial document handling)

  It is possible to retrieve a single element in an XCAP document, to
  replace it, to insert a new one or to remove one. To address an element, a
  node selector is required, which is an XPATH-like expression, defined in
  http://tools.ietf.org/html/rfc4825#section-6.3.

  Let's put the document in section 1 again to server, so we can fetch some elements from it.

  xcapclient --app resource-lists get '/resource-lists/list[@name="friends"]/entry[1]/display-name'

  etag: "856bdac9012ee28e46cebb81e51ac2a0"
  <display-name>Bill Doe</display-name>

  Specifying application with --app, is no longer necessary as it may be
  guessed from the node selector.

  To replace an element, use the node selector you would have used for
  retrieving the element but do PUT instead. For example if we want to fix
  Bill's display name:

  xcapclient -i bill_display_name_fixed.xml put '/resource-lists/list[@name="friends"]/entry[1]/display-name'

  To insert a new element one must construct a node selector that doesn't
  point to an existing element.

  xcapclient -i alice.xml put '/resource-lists/list[@name="friends"]/entry[1][@uri="sip:alice@example.com"]'

  201 Created
  etag: "bfbd38bed7163dd19e6e110d0dfa0876"

  This will shift Bill's entry to the second position.

